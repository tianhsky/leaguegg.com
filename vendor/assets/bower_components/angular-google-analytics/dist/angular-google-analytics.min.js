/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v1.1.0 - 2015-09-27
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com> (https://github.com/revolunet)
 * @contributors Julien Bouquillon (https://github.com/revolunet),Justin Saunders (https://github.com/justinsa),Chris Esplin (https://github.com/deltaepsilon),Adam Misiorny (https://github.com/adam187)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b,c,d){"use strict";c.module("angular-google-analytics",[]).provider("Analytics",function(){var e,f,g,h,i,j=!0,k="auto",l=!1,m=!1,n="USD",o=!1,p=!1,q=!1,r=!1,s=!1,t=!1,u=!1,v=!1,w="$routeChangeSuccess",x=!1,y="",z=!0,A=!1;this.log=[],this.offlineQueue=[],this.setAccount=function(a){return e=c.isUndefined(a)||a===!1?d:c.isArray(a)?a:c.isObject(a)?[a]:[{tracker:a,trackEvent:!0}],this},this.trackPages=function(a){return z=a,this},this.trackPrefix=function(a){return y=a,this},this.setDomainName=function(a){return g=a,this},this.useDisplayFeatures=function(a){return p=!!a,this},this.useAnalytics=function(a){return j=!!a,this},this.useEnhancedLinkAttribution=function(a){return s=!!a,this},this.useCrossDomainLinker=function(a){return m=!!a,this},this.setCrossLinkDomains=function(a){return f=a,this},this.setPageEvent=function(a){return w=a,this},this.setCookieConfig=function(a){return k=a,this},this.useECommerce=function(a,b){return q=!!a,r=!!b,this},this.setCurrency=function(a){return n=a,this},this.setRemoveRegExp=function(a){return a instanceof RegExp&&(i=a),this},this.setExperimentId=function(a){return h=a,this},this.ignoreFirstPageLoad=function(a){return t=!!a,this},this.trackUrlParams=function(a){return A=!!a,this},this.startOffline=function(a){return v=!!a,v===!0&&this.delayScriptTag(!0),this},this.delayScriptTag=function(a){return o=!!a,this},this.logAllCalls=function(a){return u=!!a,this},this.enterTestMode=function(){return x=!0,this},this.$get=["$document","$location","$log","$rootScope","$window",function(B,C,D,E,F){var G=this,H=function(a,b){return c.isString(b)?b+"."+a:I("name",b)?b.name+"."+a:a},I=function(a,b){return c.isObject(b)&&c.isDefined(b[a])},J=function(a,b,c){return I(a,b)&&b[a]===c},K=function(){var a=A?C.url():C.path();return i?a.replace(i,""):a},L=function(){var a={utm_source:"campaignSource",utm_medium:"campaignMedium",utm_term:"campaignTerm",utm_content:"campaignContent",utm_campaign:"campaignName"},b={};return c.forEach(C.search(),function(d,e){var f=a[e];c.isDefined(f)&&(b[f]=d)}),b},M=function(a,b,c,d,e,f,g,h,i){var j={};return a&&(j.id=a),b&&(j.affiliation=b),c&&(j.revenue=c),d&&(j.tax=d),e&&(j.shipping=e),f&&(j.coupon=f),g&&(j.list=g),h&&(j.step=h),i&&(j.option=i),j},N=function(a){!j&&F._gaq&&"function"==typeof a&&a()},O=function(){var a=Array.prototype.slice.call(arguments);return v===!0?void G.offlineQueue.push([O,a]):(F._gaq||(F._gaq=[]),u===!0&&G._log.apply(G,a),void F._gaq.push(a))},P=function(a){j&&F.ga&&"function"==typeof a&&a()},Q=function(){var a=Array.prototype.slice.call(arguments);return v===!0?void G.offlineQueue.push([Q,a]):"function"!=typeof F.ga?void G._log("warn","ga function not set on window"):(u===!0&&G._log.apply(G,a),void F.ga.apply(null,a))},R=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[0],d=[];return"function"==typeof a?e.forEach(function(b){a(b)&&d.push(b)}):d=e,0===d.length?void Q.apply(G,b):void d.forEach(function(a){b[0]=H(c,a),Q.apply(G,b)})};return this._log=function(){var a=Array.prototype.slice.call(arguments);if(a.length>0){if(a.length>1)switch(a[0]){case"warn":D.warn(a.slice(1));break;case"error":D.error(a.slice(1))}G.log.push(a)}},this._createScriptTag=function(){if(!e||e.length<1)return void G._log("warn","No account id set to create script tag");if(e.length>1&&(G._log("warn","Multiple trackers are not supported with ga.js. Using first tracker only"),e=e.slice(0,1)),l===!0)return void G._log("warn","ga.js or analytics.js script tag already created");O("_setAccount",e[0].tracker),g&&O("_setDomainName",g),s&&O("_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"),z&&!t&&(i?O("_trackPageview",K()):O("_trackPageview"));var a;return a=p===!0?("https:"===b.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===b.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",x!==!0?!function(){var b=B[0],c=b.createElement("script");c.type="text/javascript",c.async=!0,c.src=a;var d=b.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}():G._log("inject",a),l=!0,!0},this._createAnalyticsScriptTag=function(){if(!e)return void G._log("warn","No account id set to create analytics script tag");if(l===!0)return void G._log("warn","ga.js or analytics.js script tag already created");var d="//www.google-analytics.com/analytics.js";if(x!==!0?!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(a,b,"script",d,"ga"):("function"!=typeof F.ga&&(F.ga=function(){}),G._log("inject",d)),e.forEach(function(a){a.crossDomainLinker=I("crossDomainLinker",a)?a.crossDomainLinker:m,a.crossLinkDomains=I("crossLinkDomains",a)?a.crossLinkDomains:f,a.displayFeatures=I("displayFeatures",a)?a.displayFeatures:p,a.enhancedLinkAttribution=I("enhancedLinkAttribution",a)?a.enhancedLinkAttribution:s,a.trackEcommerce=I("trackEcommerce",a)?a.trackEcommerce:q,a.trackEvent=I("trackEvent",a)?a.trackEvent:!1;var b={};I("fields",a)?b=a.fields:I("cookieConfig",a)?c.isString(a.cookieConfig)?b.cookieDomain=a.cookieConfig:b=a.cookieConfig:c.isString(k)?b.cookieDomain=k:k&&(b=k),a.crossDomainLinker===!0&&(b.allowLinker=!0),I("name",a)&&(b.name=a.name),a.fields=b,Q("create",a.tracker,a.fields),a.crossDomainLinker===!0&&(Q(H("require",a),"linker"),c.isDefined(a.crossLinkDomains)&&Q(H("linker:autoLink",a),a.crossLinkDomains)),a.displayFeatures&&Q(H("require",a),"displayfeatures"),a.trackEcommerce&&(r?(Q(H("require",a),"ec"),Q(H("set",a),"&cu",n)):Q(H("require",a),"ecommerce")),a.enhancedLinkAttribution&&Q(H("require",a),"linkid"),z&&!t&&Q(H("send",a),"pageview",K())}),h){var g=b.createElement("script"),i=b.getElementsByTagName("script")[0];g.src="//www.google-analytics.com/cx/api.js?experiment="+h,i.parentNode.insertBefore(g,i)}return l=!0,!0},this._ecommerceEnabled=function(a,b){var c=q&&!r;return a===!0&&c===!1&&(q&&r?G._log("warn",b+" is not available when Enhanced Ecommerce is enabled with analytics.js"):G._log("warn","Ecommerce must be enabled to use "+b+" with analytics.js")),c},this._enhancedEcommerceEnabled=function(a,b){var c=q&&r;return a===!0&&c===!1&&G._log("warn","Enhanced Ecommerce must be enabled to use "+b+" with analytics.js"),c},this._trackPage=function(a,b,e){a=a?a:K(),b=b?b:B[0].title,N(function(){O("_set","title",b),O("_trackPageview",y+a)}),P(function(){var f={page:y+a,title:b};c.extend(f,L()),c.isObject(e)&&c.extend(f,e),R(d,"send","pageview",f)})},this._trackEvent=function(a,b,d,e,f,g){N(function(){O("_trackEvent",a,b,d,e,!!f)}),P(function(){var h={},i=function(a){return J("trackEvent",a,!0)};c.isDefined(f)&&(h.nonInteraction=!!f),c.isObject(g)&&c.extend(h,g),R(i,"send","event",a,b,d,e,h)})},this._addTrans=function(a,b,c,d,e,f,g,h,i){N(function(){O("_addTrans",a,b,c,d,e,f,g,h)}),P(function(){if(G._ecommerceEnabled(!0,"addTrans")){var f=function(a){return J("trackEcommerce",a,!0)};R(f,"ecommerce:addTransaction",{id:a,affiliation:b,revenue:c,tax:d,shipping:e,currency:i||"USD"})}})},this._addItem=function(a,b,c,d,e,f){N(function(){O("_addItem",a,b,c,d,e,f)}),P(function(){if(G._ecommerceEnabled(!0,"addItem")){var g=function(a){return J("trackEcommerce",a,!0)};R(g,"ecommerce:addItem",{id:a,name:c,sku:b,category:d,price:e,quantity:f})}})},this._trackTrans=function(){N(function(){O("_trackTrans")}),P(function(){if(G._ecommerceEnabled(!0,"trackTrans")){var a=function(a){return J("trackEcommerce",a,!0)};R(a,"ecommerce:send")}})},this._clearTrans=function(){P(function(){if(G._ecommerceEnabled(!0,"clearTrans")){var a=function(a){return J("trackEcommerce",a,!0)};R(a,"ecommerce:clear")}})},this._addProduct=function(a,b,d,e,f,g,h,i,j,k){N(function(){O("_addProduct",a,b,d,e,f,g,h,i,j)}),P(function(){if(G._enhancedEcommerceEnabled(!0,"addProduct")){var l=function(a){return J("trackEcommerce",a,!0)},m={id:a,name:b,category:d,brand:e,variant:f,price:g,quantity:h,coupon:i,position:j};c.isObject(k)&&c.extend(m,k),R(l,"ec:addProduct",m)}})},this._addImpression=function(a,b,c,d,e,f,g,h){N(function(){O("_addImpression",a,b,c,d,e,f,g,h)}),P(function(){if(G._enhancedEcommerceEnabled(!0,"addImpression")){var i=function(a){return J("trackEcommerce",a,!0)};R(i,"ec:addImpression",{id:a,name:b,category:e,brand:d,variant:f,list:c,position:g,price:h})}})},this._addPromo=function(a,b,c,d){N(function(){O("_addPromo",a,b,c,d)}),P(function(){if(G._enhancedEcommerceEnabled(!0,"addPromo")){var e=function(a){return J("trackEcommerce",a,!0)};R(e,"ec:addPromo",{id:a,name:b,creative:c,position:d})}})},this._setAction=function(a,b){N(function(){O("_setAction",a,b)}),P(function(){if(G._enhancedEcommerceEnabled(!0,"setAction")){var c=function(a){return J("trackEcommerce",a,!0)};R(c,"ec:setAction",a,b)}})},this._trackTransaction=function(a,b,c,d,e,f,g,h,i){this._setAction("purchase",M(a,b,c,d,e,f,g,h,i))},this._trackRefund=function(a){this._setAction("refund",M(a))},this._trackCheckOut=function(a,b){this._setAction("checkout",M(null,null,null,null,null,null,null,a,b))},this._trackDetail=function(){this._setAction("detail"),this._pageView()},this._trackCart=function(a){-1!==["add","remove"].indexOf(a)&&(this._setAction(a),this._trackEvent("UX","click",a+("add"===a?" to cart":" from cart")))},this._promoClick=function(a){this._setAction("promo_click"),this._trackEvent("Internal Promotions","click",a)},this._productClick=function(a){this._setAction("click",M(null,null,null,null,null,null,a,null,null)),this._trackEvent("UX","click",a)},this._pageView=function(a){P(function(){Q(H("send",a),"pageview")})},this._send=function(){var a=Array.prototype.slice.call(arguments);a.unshift("send"),P(function(){Q.apply(G,a)})},this._set=function(a,b,c){P(function(){Q(H("set",c),a,b)})},this._trackTimings=function(a,b,c,d){this._send("timing",a,b,c,d)},o||(j?this._createAnalyticsScriptTag():this._createScriptTag()),z&&E.$on(w,function(){G._trackPage()}),{log:G.log,offlineQueue:G.offlineQueue,configuration:{accounts:e,universalAnalytics:j,crossDomainLinker:m,crossLinkDomains:f,currency:n,delayScriptTag:o,displayFeatures:p,domainName:g,ecommerce:G._ecommerceEnabled(),enhancedEcommerce:G._enhancedEcommerceEnabled(),enhancedLinkAttribution:s,experimentId:h,ignoreFirstPageLoad:t,logAllCalls:u,pageEvent:w,removeRegExp:i,testMode:x,trackPrefix:y,trackRoutes:z,trackUrlParams:A},getUrl:K,setCookieConfig:G._setCookieConfig,getCookieConfig:function(){return k},createAnalyticsScriptTag:function(a){return a&&(k=a),G._createAnalyticsScriptTag()},createScriptTag:function(){return G._createScriptTag()},offline:function(a){if(a===!0&&v===!1&&(v=!0),a===!1&&v===!0)for(v=!1;G.offlineQueue.length>0;){var b=G.offlineQueue.shift();b[0].apply(G,b[1])}return v},trackPage:function(a,b,c){G._trackPage.apply(G,arguments)},trackEvent:function(a,b,c,d,e,f){G._trackEvent.apply(G,arguments)},addTrans:function(a,b,c,d,e,f,g,h,i){G._addTrans.apply(G,arguments)},addItem:function(a,b,c,d,e,f){G._addItem.apply(G,arguments)},trackTrans:function(){G._trackTrans.apply(G,arguments)},clearTrans:function(){G._clearTrans.apply(G,arguments)},addProduct:function(a,b,c,d,e,f,g,h,i,j){G._addProduct.apply(G,arguments)},addPromo:function(a,b,c,d){G._addPromo.apply(G,arguments)},addImpression:function(a,b,c,d,e,f,g,h){G._addImpression.apply(G,arguments)},productClick:function(a){G._productClick.apply(G,arguments)},promoClick:function(a){G._promoClick.apply(G,arguments)},trackDetail:function(){G._trackDetail.apply(G,arguments)},trackCart:function(a){G._trackCart.apply(G,arguments)},trackCheckout:function(a,b){G._trackCheckOut.apply(G,arguments)},trackTimings:function(a,b,c,d){G._trackTimings.apply(G,arguments)},trackTransaction:function(a,b,c,d,e,f,g,h,i){G._trackTransaction.apply(G,arguments)},setAction:function(a,b){G._setAction.apply(G,arguments)},pageView:function(){G._pageView.apply(G,arguments)},send:function(a){G._send.apply(G,arguments)},set:function(a,b,c){G._set.apply(G,arguments)}}}]}).directive("gaTrackEvent",["Analytics","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.gaTrackEvent);d.bind("click",function(){(!e.gaTrackEventIf||c.$eval(e.gaTrackEventIf))&&f.length>1&&a.trackEvent.apply(a,f(c))})}}}])}(window,document,window.angular);